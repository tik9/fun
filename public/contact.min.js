
var modalContent = document.getElementById('modal-content')
var modalTitle = document.getElementById('modal-title')

var arr = ['name', 'email', 'message']

async function mail() {
    try {
        var res = (await fetch('/mail', {
            method: 'post',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(getObj())
        })).json()
        return res
    } catch (error) { console.log('res: ', error) }
}
function validateEmail(email) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }

function getObj() {
    var obj = {}
    var missing = []
    for (var elem of arr) {

        var val = document.getElementById(elem).value
        if (val == '') missing.push(elem)

        obj[elem] = val
    }

    if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(document.getElementById('email').value) == false && missing.length == 0) missing.push('email')
    return missing.length != 0 ? missing : obj
}

var reset = document.getElementById('reset')
var send1 = document.getElementById('send1')
var send2 = document.getElementById('send2')
send1.focus()

send1.addEventListener("click", () => {
    send2.style.display = 'block'
    modalTitle.textContent = 'Correct data entered?'

    if (Array.isArray(getObj())) {
        send2.style.display = 'none'
        modalTitle.textContent = 'Data is missing or email is wrong'
    }
    modalContent.innerHTML = ''
    modalContent.append(list(getObj()))

})

send2.addEventListener("click", async () => {
    var res = await mail()
    if (!res) return

    modalTitle.textContent = 'Data entered:'
    var finalBtn = document.getElementById('final-close')
    finalBtn.style.display = 'block'
    finalBtn.setAttribute('data-bs-dismiss', 'modal')
    send2.style.display = 'none'
})

reset.addEventListener("click", () => {
    for (var elem of arr) {

        document.getElementById(elem).value = ''
    }
});

document.getElementById('final-close').addEventListener('click', () => { location.reload() })

git_code(['js/contact.min.js'])

if (location.hostname == 'localhost') {
    var count = 1
    for (var elem of arr) {
        document.getElementById(elem).value = 'a' + count
        count++
    }
}